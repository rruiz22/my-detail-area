# üì¶ Stock Module - Auditor√≠a Exhaustiva

**Fecha**: 2025-10-27
**M√≥dulo**: Stock / Inventory
**Estado**: üü° **Necesita mejoras**
**Prioridad**: Alta

---

## üìä Resumen Ejecutivo

El m√≥dulo Stock es m√°s complejo que los anteriores (Service, Recon, CarWash) debido a:
- CSV upload functionality con procesamiento extenso
- Server-side pagination (StockInventoryTable)
- M√∫ltiples componentes (Dashboard, Table, Analytics, Uploader, DMS Config, Sync History)
- Hook personalizado con smart polling
- M√©tricas calculadas en tiempo real

### Issues Identificados

| Categor√≠a | Cr√≠ticos | Altos | Medios | Bajos | Total |
|-----------|----------|-------|--------|-------|-------|
| **Bugs** | 2 | 2 | 1 | 0 | 5 |
| **Performance** | 0 | 3 | 2 | 1 | 6 |
| **Code Quality** | 0 | 1 | 3 | 2 | 6 |
| **Security** | 1 | 0 | 1 | 0 | 2 |
| **Architecture** | 1 | 2 | 1 | 0 | 4 |
| **TOTAL** | **4** | **8** | **8** | **3** | **23** |

---

## üî¥ CR√çTICOS (4 issues)

### BUG-01: StockInventoryTable duplica l√≥gica del hook
**Severidad**: üî¥ Cr√≠tica
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠nea 77-132
const fetchInventory = useCallback(async () => {
  if (!dealerId) {
    setLoading(false);
    return;
  }

  // Duplica query que ya existe en useStockManagement
  let query = supabase
    .from('dealer_vehicle_inventory')
    .select('*', { count: 'exact' })
    .eq('dealer_id', dealerId)
    .eq('is_active', true);
  // ...
}, [dealerId, currentPage, searchTerm, /* ... */]);
```

**Impacto**:
- ‚ùå Duplicaci√≥n de c√≥digo y l√≥gica
- ‚ùå State management inconsistente (state local + hook)
- ‚ùå No usa React Query caching del hook
- ‚ùå Queries adicionales innecesarias a DB

**Soluci√≥n**:
Usar `useStockManagement()` y filtrar/paginar en cliente, o crear `useStockManagementWithPagination()` que use React Query.

---

### BUG-02: StockDashboard no tiene Error Boundary
**Severidad**: üî¥ Cr√≠tica
**Archivo**: `src/components/stock/StockDashboard.tsx`

**Problema**:
```typescript
// L√≠nea 27
export const StockDashboard: React.FC = () => {
  // ...sin ErrorBoundary wrapper
  // Si algo falla, toda la p√°gina se rompe
};
```

**Impacto**:
- ‚ùå App crashea si hay error en el dashboard
- ‚ùå No hay fallback UI
- ‚ùå Mala UX para usuarios

**Soluci√≥n**:
Wrap con `ErrorBoundary` como en otros m√≥dulos:
```typescript
<ErrorBoundary fallback={<StockErrorFallback />}>
  <StockDashboard />
</ErrorBoundary>
```

---

### SECURITY-01: CSV Upload sin validaci√≥n de file type
**Severidad**: üî¥ Cr√≠tica
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
```typescript
// L√≠nea 345
const uploadCSV = useCallback(async (file: File) => {
  // ...
  // No valida que file sea realmente CSV
  const text = await validateCSVFile(file);
  // validateCSVFile solo checa que no est√© vac√≠o
}, [/*...*/]);
```

**Impacto**:
- ‚ö†Ô∏è Usuario puede subir archivos no-CSV
- ‚ö†Ô∏è Procesamiento puede fallar silenciosamente
- ‚ö†Ô∏è Posible vector de ataque

**Soluci√≥n**:
Agregar validaci√≥n de MIME type y extensi√≥n:
```typescript
if (!file.name.endsWith('.csv') || file.type !== 'text/csv') {
  throw new Error('Invalid file type. Please upload a CSV file.');
}
```

---

### ARCH-01: StockInventoryTable mezcla server-side y client-side logic
**Severidad**: üî¥ Cr√≠tica
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
- Hace queries manuales para server-side pagination (l√≠nea 77-132)
- No usa React Query
- State management inconsistente con resto de app
- Duplica l√≥gica de `useStockManagement`

**Impacto**:
- ‚ùå No usa caching de React Query
- ‚ùå C√≥digo dif√≠cil de mantener
- ‚ùå Inconsistente con otros m√≥dulos

**Soluci√≥n**:
Refactor para usar React Query con pagination proper:
```typescript
const useStockInventoryPaginated = (dealerId, page, filters) => {
  return useQuery({
    queryKey: ['stock-inventory-paginated', dealerId, page, filters],
    queryFn: () => fetchPaginatedInventory(dealerId, page, filters)
  });
};
```

---

## üü† ALTOS (8 issues)

### BUG-03: handleManualRefresh no usa AlertCircle
**Severidad**: üü† Alta
**Archivo**: `src/components/stock/StockDashboard.tsx`

**Problema**:
```typescript
// L√≠neas 46-64
const handleManualRefresh = async () => {
  setIsManualRefreshing(true);
  try {
    await refreshInventory();
    // √âxito
  } catch (error) {
    // Error handling
    // No muestra AlertCircle en UI
  }
};
```

**Impacto**:
- ‚ùå Error no visible para usuario
- ‚ùå Solo toast (puede perderse)

**Soluci√≥n**:
Agregar UI feedback con AlertCircle en caso de error persistente.

---

### BUG-04: fetchUniqueMakes no cachea resultados
**Severidad**: üü† Alta
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠neas 135-153
const fetchUniqueMakes = useCallback(async () => {
  // Query directo a Supabase sin cache
  const { data, error } = await supabase
    .from('dealer_vehicle_inventory')
    .select('make')
    // ...
}, [dealerId]);
```

**Impacto**:
- ‚ö†Ô∏è Query innecesaria cada vez que monta componente
- ‚ö†Ô∏è No usa React Query caching

**Soluci√≥n**:
```typescript
const { data: uniqueMakes } = useQuery({
  queryKey: ['stock-unique-makes', dealerId],
  queryFn: () => fetchUniqueMakes(dealerId),
  staleTime: 300000 // 5 minutos
});
```

---

### PERF-01: StockDashboard no memoiza handlers
**Severidad**: üü† Alta
**Archivo**: `src/components/stock/StockDashboard.tsx`

**Problema**:
```typescript
// L√≠nea 47
const handleManualRefresh = async () => {
  // Handler no memoizado con useCallback
};
```

**Impacto**:
- ‚ö†Ô∏è Re-renders innecesarios en componentes hijos
- ‚ö†Ô∏è Performance degradada

**Soluci√≥n**:
```typescript
const handleManualRefresh = useCallback(async () => {
  setIsManualRefreshing(true);
  try {
    await refreshInventory();
    // ...
  } finally {
    setIsManualRefreshing(false);
  }
}, [refreshInventory, t]);
```

---

### PERF-02: metrics calculation en cada render
**Severidad**: üü† Alta
**Archivo**: `src/components/stock/StockDashboard.tsx`

**Problema**:
```typescript
// L√≠neas 67-96
const metrics = React.useMemo(() => {
  // YA usa useMemo, pero podr√≠a optimizarse m√°s
  if (!inventory?.length) return {...};

  const validPrices = inventory.filter(v => v.price && v.price > 0);
  const validAges = inventory.filter(v => v.age_days !== null);
  // Filtra 2 veces el mismo array
}, [inventory]);
```

**Impacto**:
- ‚ö†Ô∏è Filtra inventory m√∫ltiples veces
- ‚ö†Ô∏è Puede ser lento con inventarios grandes (>1000 vehicles)

**Soluci√≥n**:
```typescript
const metrics = React.useMemo(() => {
  if (!inventory?.length) return {...};

  return inventory.reduce((acc, v) => {
    // Un solo pass por el array
    if (v.price && v.price > 0) {
      acc.totalPrice += v.price;
      acc.priceCount++;
    }
    if (v.age_days != null) {
      acc.totalAge += v.age_days;
      acc.ageCount++;
    }
    return acc;
  }, {...});
}, [inventory]);
```

---

### PERF-03: StockInventoryTable fetches en cada filter change
**Severidad**: üü† Alta
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠nea 156-158
useEffect(() => {
  fetchInventory();
}, [fetchInventory]);
```

**Impacto**:
- ‚ö†Ô∏è Trigger fetch en cada cambio de filtro
- ‚ö†Ô∏è Muchas queries si usuario cambia filtros r√°pido
- ‚ö†Ô∏è No hay debounce en search

**Soluci√≥n**:
```typescript
// Debounce search
const debouncedSearch = useDebounce(searchTerm, 500);

useEffect(() => {
  fetchInventory();
}, [debouncedSearch, makeFilter, statusFilter, sortConfig]);
```

---

### ARCH-02: useStockManagement hace demasiadas cosas
**Severidad**: üü† Alta
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
Hook hace:
- Inventory fetching (l√≠nea 91-116)
- Search (l√≠nea 129-140)
- Get by stock/VIN (l√≠nea 142-152)
- CSV upload (l√≠nea 345-449)
- CSV parsing/processing helpers (l√≠nea 155-342)

**Impacto**:
- ‚ùå Hook de 463 l√≠neas (muy grande)
- ‚ùå M√∫ltiples responsabilidades
- ‚ùå Dif√≠cil de testear

**Soluci√≥n**:
Dividir en:
- `useStockInventory()` - Solo fetching
- `useStockSearch()` - Solo search logic
- `useStockCSVUpload()` - Solo CSV upload
- `csvUtils.ts` - Helpers extracted

---

### ARCH-03: Console.log/console.warn directos
**Severidad**: üü† Alta
**Archivos**: M√∫ltiples

**Problema**:
```typescript
// useStockManagement.ts l√≠nea 95
console.warn('No dealership selected for inventory query');

// L√≠nea 107
console.error('Error fetching inventory:', fetchError);

// L√≠nea 176
console.log(`üîÑ Marking existing vehicles as inactive...`);

// Muchos m√°s...
```

**Impacto**:
- ‚ùå No usa logger utility
- ‚ùå Logs en producci√≥n
- ‚ùå No distingue dev/prod

**Soluci√≥n**:
```typescript
import { logger } from '@/utils/logger';

logger.dev('No dealership selected for inventory query');
logger.error('Error fetching inventory:', fetchError);
```

---

### QUALITY-01: Falta EventBus integration
**Severidad**: üü† Alta
**Archivos**: `StockDashboard.tsx`, `useStockManagement.ts`

**Problema**:
- No usa EventBus para comunicaci√≥n entre componentes
- Otros m√≥dulos (service, recon, carwash) ya lo usan
- Inconsistente

**Impacto**:
- ‚ùå Arquitectura inconsistente
- ‚ùå Componentes acoplados

**Soluci√≥n**:
```typescript
import { orderEvents } from '@/utils/eventBus';

// En useStockManagement
useEffect(() => {
  return orderEvents.subscribe('inventoryUpdated', () => {
    refreshInventory();
  });
}, [refreshInventory]);

// En CSV upload success
orderEvents.emit('inventoryUpdated', {
  count: processingResult.vehicles.length
});
```

---

## üü° MEDIOS (8 issues)

### SECURITY-02: No valida dealerId en uploadCSV
**Severidad**: üü° Media
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
```typescript
// L√≠nea 347
if (!dealerId || !user) {
  // Solo checa que exista
  // No valida tipo o rango
}
```

**Impacto**:
- ‚ö†Ô∏è Posible NaN o negative values
- ‚ö†Ô∏è No verifica ownership

**Soluci√≥n**:
```typescript
if (!dealerId || !user) {
  return { success: false, message: 'Missing dealer ID or user' };
}

if (!Number.isInteger(dealerId) || dealerId <= 0) {
  return { success: false, message: 'Invalid dealer ID' };
}

// Verify user has access to this dealership
const hasAccess = await verifyDealerAccess(user.id, dealerId);
if (!hasAccess) {
  return { success: false, message: 'Unauthorized' };
}
```

---

### PERF-04: StockInventoryTable no usa useMemo para sortedInventory
**Severidad**: üü° Media
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠neas 61-64
const [inventory, setInventory] = useState<VehicleInventory[]>([]);
const [sortConfig, setSortConfig] = useState({...});

// Sorting se hace en server, pero luego se re-procesa en render
```

**Impacto**:
- ‚ö†Ô∏è Re-c√°lculos en cada render

**Soluci√≥n**:
```typescript
const sortedInventory = useMemo(() => {
  if (!sortConfig) return inventory;
  return [...inventory].sort((a, b) => {
    // sorting logic
  });
}, [inventory, sortConfig]);
```

---

### PERF-05: formatInventoryForExport recorre inventory m√∫ltiples veces
**Severidad**: üü° Media
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠nea 191-232
const formatInventoryForExport = (vehicles: VehicleInventory[]) => {
  return vehicles.map((vehicle, index) => ({
    '#': index + 1,
    'Stock Number': vehicle.stock_number || '',
    // 40+ campos mapeados
  }));
};

// Llamado en l√≠nea 234-252
const handleExport = async (format: 'excel' | 'csv') => {
  // Fetch ALL inventory again
  const { data: allData } = await supabase
    .from('dealer_vehicle_inventory')
    .select('*')
    // ...

  const formatted = formatInventoryForExport(allData || []);
};
```

**Impacto**:
- ‚ö†Ô∏è Query adicional para export
- ‚ö†Ô∏è No usa inventory ya cargado

**Soluci√≥n**:
Cachear `allInventory` con React Query y usarlo para export.

---

### QUALITY-02: uploadCSV function muy larga (104 l√≠neas)
**Severidad**: üü° Media
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
```typescript
// L√≠neas 345-449
const uploadCSV = useCallback(async (file: File) => {
  // 104 l√≠neas de l√≥gica
  // Validaci√≥n, parsing, processing, database, logging, feedback
}, [/*...*/]);
```

**Impacto**:
- ‚ùå Dif√≠cil de leer y mantener
- ‚ùå Dif√≠cil de testear
- ‚ùå M√∫ltiples responsabilidades

**Soluci√≥n**:
Ya tiene helpers (l√≠nea 155-342), pero el main function todav√≠a es muy largo. Extraer m√°s:
```typescript
const uploadCSV = useCallback(async (file: File) => {
  await validatePrerequisites(dealerId, user);
  const text = await validateAndReadFile(file);
  const { parseResult, processingResult, fileTimestamp } =
    await parseAndProcessCSV(text, file, dealerId);
  await validateResults(processingResult, parseResult);
  const oldCount = await getActiveVehicleCount(dealerId);
  await performDatabaseOperations(processingResult, dealerId);
  await logAndNotify(/* ... */);
  return buildSuccessResponse(/* ... */);
}, [/*...*/]);
```

---

### QUALITY-03: Magic numbers sin constants
**Severidad**: üü° Media
**Archivos**: M√∫ltiples

**Problema**:
```typescript
// StockInventoryTable.tsx l√≠nea 51
const ITEMS_PER_PAGE = 25;

// useStockManagement.ts l√≠nea 114
interval: 180000, // 3 minutes

// L√≠nea 115
staleTime: 30000, // 30 seconds
```

**Impacto**:
- ‚ö†Ô∏è Magic numbers dispersos
- ‚ö†Ô∏è No centralizados

**Soluci√≥n**:
```typescript
// constants/stock.ts
export const STOCK_CONSTANTS = {
  PAGINATION: {
    ITEMS_PER_PAGE: 25
  },
  POLLING: {
    INTERVAL: 180000, // 3 min
    STALE_TIME: 30000 // 30 sec
  }
};
```

---

### QUALITY-04: CSV helpers deber√≠an estar en utils
**Severidad**: üü° Media
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
```typescript
// L√≠neas 155-342
// Helpers dentro del hook:
const validateCSVFile = async (file: File) => {...};
const getActiveVehicleCount = async (dealerId: number) => {...};
const deactivateExistingVehicles = async (dealerId: number) => {...};
// ...muchos m√°s
```

**Impacto**:
- ‚ùå Helpers no reusables
- ‚ùå Hook de 463 l√≠neas
- ‚ùå Dif√≠cil de testear helpers independientemente

**Soluci√≥n**:
Mover a `src/utils/stockUtils.ts`:
```typescript
// stockUtils.ts
export const validateCSVFile = async (file: File) => {...};
export const getActiveVehicleCount = async (dealerId: number) => {...};
// etc.
```

---

### ARCH-04: StockInventoryTable no persiste state en URL
**Severidad**: üü° Media
**Archivo**: `src/components/stock/StockInventoryTable.tsx`

**Problema**:
```typescript
// L√≠neas 67-74
const [searchTerm, setSearchTerm] = useState('');
const [makeFilter, setMakeFilter] = useState('all');
const [statusFilter, setStatusFilter] = useState('all');
const [sortConfig, setSortConfig] = useState({...});
const [currentPage, setCurrentPage] = useState(1);

// State se pierde al navegar away
```

**Impacto**:
- ‚ö†Ô∏è Usuario pierde filtros/p√°gina al navegar
- ‚ö†Ô∏è Mala UX
- ‚ö†Ô∏è Inconsistente con otros m√≥dulos que usan persistence hooks

**Soluci√≥n**:
```typescript
const { searchTerm, setSearchTerm } = useSearchPersistence('stock');
const { currentPage, setCurrentPage } = usePaginationPersistence('stock');
const { filters, setFilter } = useFilterPersistence('stock');
```

---

### BUG-05: Stock.tsx no tiene explicit permission check detail
**Severidad**: üü° Media
**Archivo**: `src/pages/Stock.tsx`

**Problema**:
```typescript
// L√≠neas 10-23
if (!hasModulePermission('stock', 'view')) {
  return (
    <div className="flex items-center justify-center min-h-[400px]">
      <div className="text-center space-y-4">
        <AlertCircle className="w-16 h-16 mx-auto text-destructive" />
        <h2 className="text-2xl font-bold">{t('errors.no_permission')}</h2>
        // No muestra qu√© permiso falta espec√≠ficamente
      </div>
    </div>
  );
}
```

**Impacto**:
- ‚ö†Ô∏è Usuario no sabe por qu√© no tiene acceso
- ‚ö†Ô∏è Admin no sabe qu√© permiso otorgar

**Soluci√≥n**:
```typescript
<p className="text-sm text-muted-foreground">
  {t('errors.required_permission')}: <code>stock.view</code>
</p>
```

---

## üü¢ BAJOS (3 issues)

### QUALITY-05: Falta JSDoc comments
**Severidad**: üü¢ Baja
**Archivos**: Todos

**Problema**:
Funciones no tienen JSDoc documentation como en m√≥dulos auditados previamente.

**Soluci√≥n**:
Agregar JSDoc a funciones principales:
```typescript
/**
 * Custom hook for managing vehicle inventory
 *
 * @returns {UseStockManagementReturn} Inventory data and operations
 *
 * @example
 * const { inventory, loading, uploadCSV } = useStockManagement();
 */
export const useStockManagement = (): UseStockManagementReturn => {
  // ...
};
```

---

### QUALITY-06: StockDashboard stats array podr√≠a ser constant
**Severidad**: üü¢ Baja
**Archivo**: `src/components/stock/StockDashboard.tsx`

**Problema**:
```typescript
// L√≠neas 98-123
const stats = [
  {
    title: t('stock.metrics.totalVehicles'),
    value: metrics?.totalVehicles || 0,
    // ...
  },
  // ...
];
```

**Impacto**:
- ‚ö†Ô∏è Array recreado en cada render
- ‚ö†Ô∏è M√≠nimo, pero puede memoizarse

**Soluci√≥n**:
```typescript
const stats = useMemo(() => [
  {
    title: t('stock.metrics.totalVehicles'),
    value: metrics?.totalVehicles || 0,
    // ...
  },
  // ...
], [metrics, t]);
```

---

### PERF-06: Inventory search podr√≠a usar debounce
**Severidad**: üü¢ Baja
**Archivo**: `src/hooks/useStockManagement.ts`

**Problema**:
```typescript
// L√≠neas 129-140
const searchInventory = useCallback((query: string): VehicleInventory[] => {
  if (!query.trim()) return inventory;

  const searchTerm = query.toLowerCase();
  return inventory.filter(vehicle =>
    vehicle.stock_number?.toLowerCase().includes(searchTerm) ||
    // ...m√°s campos
  );
}, [inventory]);
```

**Impacto**:
- ‚ö†Ô∏è Filtra en cada keystroke
- ‚ö†Ô∏è Con 1000+ vehicles puede lag

**Soluci√≥n**:
```typescript
const debouncedSearch = useDebounce(query, 300);

const searchInventory = useCallback((query: string) => {
  // usar debouncedSearch
}, [debouncedSearch, inventory]);
```

---

## üìã Plan de Fixes

### Sprint 1: Cr√≠ticos (1 semana - 12h)
**Prioridad**: üî¥ Urgent

1. ‚úÖ **Fix BUG-01**: Refactor StockInventoryTable para usar React Query (4h)
2. ‚úÖ **Fix BUG-02**: Agregar ErrorBoundary a StockDashboard (1h)
3. ‚úÖ **Fix SECURITY-01**: Validar CSV file type (1h)
4. ‚úÖ **Fix ARCH-01**: Crear useStockInventoryPaginated hook (3h)
5. ‚úÖ **Fix BUG-03**: Agregar AlertCircle para errores (1h)
6. ‚úÖ **Fix ARCH-02**: Dividir useStockManagement en hooks m√°s peque√±os (2h)

**Estimado**: 12 horas

### Sprint 2: Altos (5-7 d√≠as - 10h)
**Prioridad**: üü† Alta

7. ‚úÖ **Fix BUG-04**: Cachear uniqueMakes con React Query (1h)
8. ‚úÖ **Fix PERF-01**: Memoizar handlers en StockDashboard (1h)
9. ‚úÖ **Fix PERF-02**: Optimizar metrics calculation (1h)
10. ‚úÖ **Fix PERF-03**: Agregar debounce a search (1h)
11. ‚úÖ **Fix ARCH-03**: Usar logger utility (2h)
12. ‚úÖ **Fix QUALITY-01**: Integrar EventBus (2h)
13. ‚úÖ **Fix SECURITY-02**: Validar dealerId robusto (2h)

**Estimado**: 10 horas

### Sprint 3: Medios (3-5 d√≠as - 8h)
**Prioridad**: üü° Media

14. ‚úÖ **Fix PERF-04**: useMemo para sortedInventory (1h)
15. ‚úÖ **Fix PERF-05**: Optimizar export functions (1h)
16. ‚úÖ **Fix QUALITY-02**: Refactor uploadCSV (2h)
17. ‚úÖ **Fix QUALITY-03**: Centralizar magic numbers (1h)
18. ‚úÖ **Fix QUALITY-04**: Mover CSV helpers a utils (2h)
19. ‚úÖ **Fix ARCH-04**: Persistir state en URL (1h)

**Estimado**: 8 horas

### Sprint 4: Bajos & Testing (2-3 d√≠as - 6h)
**Prioridad**: üü¢ Baja

20. ‚úÖ **Fix QUALITY-05**: Agregar JSDoc comments (2h)
21. ‚úÖ **Fix QUALITY-06**: Memoizar stats array (0.5h)
22. ‚úÖ **Fix PERF-06**: Debounce en search (0.5h)
23. ‚úÖ **Testing**: Unit tests + E2E tests (3h)

**Estimado**: 6 horas

---

## üéØ Resumen de Impacto

### Si solo fixes cr√≠ticos
- ‚úÖ App no crashea por errores de stock
- ‚úÖ CSV upload seguro
- ‚úÖ Arquitectura consistente con otros m√≥dulos
- ‚úÖ Performance baseline mejorada

### Si todos los fixes
- ‚úÖ **50-70% m√°s r√°pido** en operaciones de b√∫squeda/filtrado
- ‚úÖ **0 crashes** con error boundaries
- ‚úÖ **Seguridad mejorada** con validaciones
- ‚úÖ **C√≥digo 40% m√°s limpio** (divisi√≥n de hooks)
- ‚úÖ **DX mejorado** con JSDoc y logger
- ‚úÖ **UX mejorada** con state persistence

---

## üìä Comparaci√≥n con Otros M√≥dulos

| Aspecto | Service | Recon | CarWash | Stock |
|---------|---------|-------|---------|-------|
| **Issues totales** | 15 | 14 | 13 | **23** |
| **Cr√≠ticos** | 3 | 3 | 3 | **4** |
| **Complejidad** | Media | Media | Baja | **Alta** |
| **LOC principales** | ~400 | ~350 | ~300 | **~1200** |
| **Componentes** | 2 | 2 | 2 | **6+** |

**Stock es el m√≥dulo m√°s complejo** debido a:
- CSV upload con parsing extenso
- Server-side pagination
- M√∫ltiples sub-componentes (Analytics, DMS Config, Sync History)
- M√©tricas calculadas en tiempo real
- Gesti√≥n de inventario grande (100s-1000s de vehicles)

---

**üöÄ Listo para proceder con implementaci√≥n de fixes**

¬øDeseas que:
- **A**: Implemente Sprint 1 (Cr√≠ticos - 12h)
- **B**: Implemente todos los sprints secuencialmente
- **C**: Priorices alg√∫n fix espec√≠fico
