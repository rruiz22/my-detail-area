# ğŸ—ï¸ DIAGRAMAS DE ARQUITECTURA - SISTEMA DE NOTIFICACIONES

## 1. ARQUITECTURA ACTUAL (Estado Real)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React + TypeScript)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   SISTEMA GLOBAL         â”‚      â”‚   SISTEMA GET READY          â”‚    â”‚
â”‚  â”‚   (Parcialmente usado)   â”‚      â”‚   (Completamente funcional)  â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                          â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  NotificationBell        â”‚      â”‚  NotificationBell            â”‚    â”‚
â”‚  â”‚  â†“                       â”‚      â”‚  â†“                           â”‚    â”‚
â”‚  â”‚  SmartNotificationCenter â”‚      â”‚  NotificationPanel           â”‚    â”‚
â”‚  â”‚  â†“                       â”‚      â”‚  â†“                           â”‚    â”‚
â”‚  â”‚  useSmartNotifications  â”‚      â”‚  useGetReadyNotifications    â”‚    â”‚
â”‚  â”‚  â†“                       â”‚      â”‚  â†“                           â”‚    â”‚
â”‚  â”‚  notification_log âœ…     â”‚      â”‚  get_ready_notifications âœ…  â”‚    â”‚
â”‚  â”‚                          â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  âŒ No accesible:        â”‚      â”‚  âœ… Todo funciona:           â”‚    â”‚
â”‚  â”‚  - Preferences Modal     â”‚      â”‚  - Settings Modal            â”‚    â”‚
â”‚  â”‚  - Analytics Dashboard   â”‚      â”‚  - Real-time updates         â”‚    â”‚
â”‚  â”‚                          â”‚      â”‚  - Filters & actions         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SERVICIOS (No conectados)                                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  NotificationService (enterprise)                                â”‚   â”‚
â”‚  â”‚  PushNotificationService (config pendiente)                      â”‚   â”‚
â”‚  â”‚  useEnhancedNotifications (no usado)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SUPABASE (Backend)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ TABLAS ENTERPRISE     â”‚     â”‚ TABLAS LEGACY (En uso)          â”‚     â”‚
â”‚  â”‚ (Subutilizadas)      â”‚     â”‚                                 â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                       â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ notification_log      â”‚     â”‚ get_ready_notifications         â”‚     â”‚
â”‚  â”‚ â”œâ”€ 27 columnas       â”‚     â”‚ â”œâ”€ 15 columnas                 â”‚     â”‚
â”‚  â”‚ â”œâ”€ 10 Ã­ndices        â”‚     â”‚ â”œâ”€ 7 Ã­ndices                   â”‚     â”‚
â”‚  â”‚ â”œâ”€ 6 RLS policies    â”‚     â”‚ â”œâ”€ 4 RLS policies              â”‚     â”‚
â”‚  â”‚ â””â”€ ğŸŸ¡ Casi vacÃ­a     â”‚     â”‚ â””â”€ âœ… En uso activo            â”‚     â”‚
â”‚  â”‚                       â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ notification_delivery â”‚     â”‚ user_notification_preferences   â”‚     â”‚
â”‚  â”‚ _log                 â”‚     â”‚ (deprecated)                    â”‚     â”‚
â”‚  â”‚ â””â”€ ğŸŸ¡ No usado       â”‚     â”‚ â””â”€ âš ï¸ AÃºn en uso              â”‚     â”‚
â”‚  â”‚                       â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ user_notification_    â”‚     â”‚ user_sms_notification_         â”‚     â”‚
â”‚  â”‚ preferences_universal â”‚     â”‚ preferences (deprecated)        â”‚     â”‚
â”‚  â”‚ â””â”€ ğŸŸ¡ No poblada     â”‚     â”‚ â””â”€ âš ï¸ AÃºn en uso              â”‚     â”‚
â”‚  â”‚                       â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ dealer_notification_  â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ rules                â”‚     â”‚                                 â”‚     â”‚
â”‚  â”‚ â””â”€ ğŸŸ¡ No poblada     â”‚     â”‚                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ EDGE FUNCTIONS (Implementadas, no verificadas)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ enhanced-notification-engine (procesa queue)                     â”‚   â”‚
â”‚  â”‚ push-notification-sender (VAPID no configurado)                  â”‚   â”‚
â”‚  â”‚ notification-logging (sin uso activo)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUJO ACTUAL DE NOTIFICACIONES GET READY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. EVENTO TRIGGER                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Cambio en get_ready_vehicles:        â”‚
        â”‚ - sla_status â†’ 'yellow' o 'red'     â”‚
        â”‚ - requires_approval â†’ true          â”‚
        â”‚ - current_step_id â†’ cambiÃ³          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. DATABASE TRIGGER                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ trigger_sla_warning_notification     â”‚
        â”‚ trigger_approval_pending_notificationâ”‚
        â”‚ trigger_step_completion_notification â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. INSERT INTO get_ready_notifications                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ notification_id: UUID                â”‚
        â”‚ dealer_id: BIGINT                    â”‚
        â”‚ user_id: UUID (o NULL para todos)   â”‚
        â”‚ type: 'sla_warning'                  â”‚
        â”‚ priority: 'high'                     â”‚
        â”‚ title: "SLA Warning"                 â”‚
        â”‚ message: "Vehicle #B35009B..."       â”‚
        â”‚ is_read: false                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. REAL-TIME SUBSCRIPTION (Supabase)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ useGetReadyNotifications.tsx         â”‚
        â”‚ â†“                                    â”‚
        â”‚ Escucha eventos INSERT               â”‚
        â”‚ â†“                                    â”‚
        â”‚ Actualiza estado React (optimistic) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. UI UPDATE                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ NotificationBell                     â”‚
        â”‚ â”œâ”€ Badge: +1                         â”‚
        â”‚ â”œâ”€ AnimaciÃ³n "wiggle"                â”‚
        â”‚ â””â”€ Color segÃºn prioridad             â”‚
        â”‚                                      â”‚
        â”‚ NotificationPanel                    â”‚
        â”‚ â”œâ”€ Nueva notificaciÃ³n arriba         â”‚
        â”‚ â”œâ”€ Badge "New"                       â”‚
        â”‚ â””â”€ Unread counter actualizado        â”‚
        â”‚                                      â”‚
        â”‚ Browser Notification                 â”‚
        â”‚ â””â”€ Si habilitado y prioridad alta    â”‚
        â”‚                                      â”‚
        â”‚ Sound Alert                          â”‚
        â”‚ â””â”€ SegÃºn prioridad                   â”‚
        â”‚                                      â”‚
        â”‚ Toast (in-app)                       â”‚
        â”‚ â””â”€ Si critical/high                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ARQUITECTURA OBJETIVO (Lo que deberÃ­a ser)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React + TypeScript)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SISTEMA UNIFICADO (Single Source of Truth)                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [Header Global]                                                 â”‚   â”‚
â”‚  â”‚     â†“                                                            â”‚   â”‚
â”‚  â”‚  NotificationBell (Ãºnico, global)                                â”‚   â”‚
â”‚  â”‚     â”œâ”€ Badge counter (todos los mÃ³dulos)                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Click â†’ SmartNotificationCenter                           â”‚   â”‚
â”‚  â”‚     â””â”€ [âš™ï¸] â†’ NotificationPreferencesModal                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  SmartNotificationCenter                                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Tabs: [Grouped] [All] [Unread]                           â”‚   â”‚
â”‚  â”‚     â”œâ”€ Filters: Module, Priority, Date                           â”‚   â”‚
â”‚  â”‚     â”œâ”€ Actions: Mark as read, Delete, Navigate                   â”‚   â”‚
â”‚  â”‚     â””â”€ Real-time updates                                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  NotificationPreferencesModal                                    â”‚   â”‚
â”‚  â”‚     â”œâ”€ Tab 1: Channels (SMS, Email, Push, In-App)              â”‚   â”‚
â”‚  â”‚     â”œâ”€ Tab 2: Priorities (Low â†’ Critical)                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Tab 3: Schedule (Quiet Hours)                            â”‚   â”‚
â”‚  â”‚     â””â”€ Tab 4: Entities (MÃ³dulos)                                â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  useSmartNotifications                                           â”‚   â”‚
â”‚  â”‚     â”œâ”€ Fetch desde notification_log                             â”‚   â”‚
â”‚  â”‚     â”œâ”€ Real-time subscriptions                                  â”‚   â”‚
â”‚  â”‚     â”œâ”€ Grouping & filtering                                     â”‚   â”‚
â”‚  â”‚     â””â”€ Actions (read, delete, etc)                              â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   SERVICIOS INTEGRADOS                                           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  NotificationService (singleton)                                 â”‚   â”‚
â”‚  â”‚     â”œâ”€ send(request) â†’ Queue notification                        â”‚   â”‚
â”‚  â”‚     â”œâ”€ sendBatch(requests) â†’ Bulk sending                        â”‚   â”‚
â”‚  â”‚     â”œâ”€ getTemplates() â†’ Template management                      â”‚   â”‚
â”‚  â”‚     â”œâ”€ getUserPreferences() â†’ User settings                      â”‚   â”‚
â”‚  â”‚     â””â”€ trackAnalytics() â†’ Metrics                                â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  PushNotificationService                                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ requestPermission() â†’ Browser permission                  â”‚   â”‚
â”‚  â”‚     â”œâ”€ subscribe() â†’ Register subscription                       â”‚   â”‚
â”‚  â”‚     â””â”€ sendTest() â†’ Test push                                    â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SUPABASE (Backend)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ TABLAS ENTERPRISE (Ãšnica fuente de verdad)                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  notification_log (main table)                                   â”‚   â”‚
â”‚  â”‚     â”œâ”€ Todos los mÃ³dulos                                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Multi-priority                                            â”‚   â”‚
â”‚  â”‚     â”œâ”€ Entity linking                                            â”‚   â”‚
â”‚  â”‚     â”œâ”€ Read/unread tracking                                      â”‚   â”‚
â”‚  â”‚     â””â”€ Threading support                                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  notification_delivery_log                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Por canal (SMS, Email, Push, In-App)                     â”‚   â”‚
â”‚  â”‚     â”œâ”€ Estado (pending, sent, delivered, failed)                â”‚   â”‚
â”‚  â”‚     â”œâ”€ Retry tracking                                            â”‚   â”‚
â”‚  â”‚     â””â”€ Error logging                                             â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  user_notification_preferences_universal                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Por (user_id, dealer_id, module)                         â”‚   â”‚
â”‚  â”‚     â”œâ”€ Channel preferences                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Event preferences (JSONB)                                 â”‚   â”‚
â”‚  â”‚     â”œâ”€ Quiet hours                                               â”‚   â”‚
â”‚  â”‚     â””â”€ Rate limiting                                             â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  dealer_notification_rules                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Business rules                                            â”‚   â”‚
â”‚  â”‚     â”œâ”€ Recipient targeting                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Conditions (JSONB)                                        â”‚   â”‚
â”‚  â”‚     â””â”€ Priority override                                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  notification_templates                                          â”‚   â”‚
â”‚  â”‚     â”œâ”€ System templates                                          â”‚   â”‚
â”‚  â”‚     â”œâ”€ Custom templates                                          â”‚   â”‚
â”‚  â”‚     â”œâ”€ Multi-channel content                                     â”‚   â”‚
â”‚  â”‚     â””â”€ Variable interpolation                                    â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ EDGE FUNCTIONS (Procesamiento)                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  enhanced-notification-engine                                    â”‚   â”‚
â”‚  â”‚     â”œâ”€ Procesa notification_log                                  â”‚   â”‚
â”‚  â”‚     â”œâ”€ EvalÃºa preferencias de usuario                            â”‚   â”‚
â”‚  â”‚     â”œâ”€ Aplica reglas de dealer                                   â”‚   â”‚
â”‚  â”‚     â”œâ”€ Renderiza templates                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Respeta quiet hours                                       â”‚   â”‚
â”‚  â”‚     â”œâ”€ Verifica rate limits                                      â”‚   â”‚
â”‚  â”‚     â””â”€ Despacha a channel handlers                               â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Channel Handlers:                                               â”‚   â”‚
â”‚  â”‚     â”œâ”€ push-notification-sender (Web Push API)                   â”‚   â”‚
â”‚  â”‚     â”œâ”€ sms-sender (Twilio/MessageBird)                          â”‚   â”‚
â”‚  â”‚     â”œâ”€ email-sender (Sendgrid/Resend)                           â”‚   â”‚
â”‚  â”‚     â””â”€ webhook-sender (Custom integrations)                      â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  notification-logger                                             â”‚   â”‚
â”‚  â”‚     â””â”€ Escribe a notification_delivery_log                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Twilio    â”‚  â”‚  Sendgrid   â”‚  â”‚  Firebase   â”‚  â”‚   Custom    â”‚  â”‚
â”‚  â”‚     SMS     â”‚  â”‚    Email    â”‚  â”‚  Cloud Msg  â”‚  â”‚  Webhooks   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. FLUJO COMPLETO DE UNA NOTIFICACIÃ“N (Objetivo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 1: EVENTO OCURRE EN CUALQUIER MÃ“DULO                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Sales Order: Nuevo pedido creado                   â”‚
    â”‚ Service Order: Estado cambiado a "completed"       â”‚
    â”‚ Get Ready: SLA crÃ­tico                            â”‚
    â”‚ Recon: Approval requerido                         â”‚
    â”‚ Car Wash: Turno asignado                          â”‚
    â”‚ Contact: Nuevo lead                               â”‚
    â”‚ Chat: Mensaje recibido                            â”‚
    â”‚ System: Mantenimiento programado                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 2: CÃ“DIGO DEL MÃ“DULO LLAMA NotificationService             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ await notificationService.send({                   â”‚
    â”‚   dealerId: 5,                                     â”‚
    â”‚   userId: 'uuid',                                  â”‚
    â”‚   notificationType: 'order_created',               â”‚
    â”‚   entityType: 'order',                             â”‚
    â”‚   entityId: '12345',                               â”‚
    â”‚   channels: ['in_app', 'push', 'sms'],            â”‚
    â”‚   data: {                                          â”‚
    â”‚     order_number: '12345',                         â”‚
    â”‚     customer_name: 'John Doe',                     â”‚
    â”‚     status: 'pending'                              â”‚
    â”‚   },                                               â”‚
    â”‚   priority: 'high'                                 â”‚
    â”‚ });                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 3: NotificationService PROCESA REQUEST                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Valida request                                  â”‚
    â”‚ 2. Obtiene user preferences                        â”‚
    â”‚ 3. Obtiene dealer config                           â”‚
    â”‚ 4. Aplica filtros (quiet hours, enabled channels)  â”‚
    â”‚ 5. Verifica rate limits                            â”‚
    â”‚ 6. Renderiza template (si existe)                  â”‚
    â”‚ 7. Inserta en notification_log                     â”‚
    â”‚ 8. Llama Edge Function                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 4: INSERT INTO notification_log                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT INTO notification_log (                     â”‚
    â”‚   user_id, dealer_id, module, event,              â”‚
    â”‚   entity_type, entity_id,                         â”‚
    â”‚   title, message, action_url,                     â”‚
    â”‚   priority, target_channels,                      â”‚
    â”‚   is_read, created_at                             â”‚
    â”‚ ) VALUES (...)                                     â”‚
    â”‚                                                    â”‚
    â”‚ â†’ Retorna notification_id                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 5: REAL-TIME SUBSCRIPTION DISPARA UPDATE EN UI             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ useSmartNotifications recibe evento INSERT        â”‚
    â”‚ â†“                                                  â”‚
    â”‚ Actualiza estado React (optimistic)               â”‚
    â”‚ â†“                                                  â”‚
    â”‚ NotificationBell:                                  â”‚
    â”‚   - Badge +1                                       â”‚
    â”‚   - AnimaciÃ³n wiggle                               â”‚
    â”‚   - Color segÃºn prioridad                          â”‚
    â”‚ â†“                                                  â”‚
    â”‚ Sound alert (si habilitado)                        â”‚
    â”‚ â†“                                                  â”‚
    â”‚ Browser notification (si permiso)                  â”‚
    â”‚ â†“                                                  â”‚
    â”‚ Toast (si high/urgent/critical)                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 6: EDGE FUNCTION PROCESA OTROS CANALES (Async)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ enhanced-notification-engine                       â”‚
    â”‚ â†“                                                  â”‚
    â”‚ Para cada canal en target_channels:                â”‚
    â”‚                                                    â”‚
    â”‚   PUSH:                                            â”‚
    â”‚   â”œâ”€ Obtiene subscriptions activas                â”‚
    â”‚   â”œâ”€ EnvÃ­a via Web Push API                       â”‚
    â”‚   â””â”€ Log resultado                                 â”‚
    â”‚                                                    â”‚
    â”‚   SMS:                                             â”‚
    â”‚   â”œâ”€ Obtiene phone number                         â”‚
    â”‚   â”œâ”€ Llama Twilio API                             â”‚
    â”‚   â””â”€ Log resultado                                 â”‚
    â”‚                                                    â”‚
    â”‚   EMAIL:                                           â”‚
    â”‚   â”œâ”€ Renderiza HTML template                      â”‚
    â”‚   â”œâ”€ Llama Sendgrid API                           â”‚
    â”‚   â””â”€ Log resultado                                 â”‚
    â”‚                                                    â”‚
    â”‚   WEBHOOK:                                         â”‚
    â”‚   â”œâ”€ Construye payload                            â”‚
    â”‚   â”œâ”€ POST a URL configurada                       â”‚
    â”‚   â””â”€ Log resultado                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 7: DELIVERY LOG ACTUALIZADO                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT INTO notification_delivery_log (            â”‚
    â”‚   notification_id,                                 â”‚
    â”‚   channel: 'push',                                 â”‚
    â”‚   status: 'delivered',                             â”‚
    â”‚   delivered_at: NOW(),                             â”‚
    â”‚   provider: 'web-push',                            â”‚
    â”‚   metadata: {...}                                  â”‚
    â”‚ )                                                  â”‚
    â”‚                                                    â”‚
    â”‚ â†’ Permite tracking y analytics                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PASO 8: USUARIO INTERACTÃšA                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Usuario click en notificaciÃ³n:                     â”‚
    â”‚                                                    â”‚
    â”‚ IN-APP:                                            â”‚
    â”‚   â”œâ”€ Marca como leÃ­da                             â”‚
    â”‚   â”œâ”€ Navega a action_url                          â”‚
    â”‚   â””â”€ Analytics: 'clicked'                          â”‚
    â”‚                                                    â”‚
    â”‚ PUSH (Browser):                                    â”‚
    â”‚   â”œâ”€ Service Worker captura click                 â”‚
    â”‚   â”œâ”€ Abre/enfoca app                               â”‚
    â”‚   â”œâ”€ Navega a URL                                  â”‚
    â”‚   â””â”€ Marca como leÃ­da                             â”‚
    â”‚                                                    â”‚
    â”‚ SMS:                                               â”‚
    â”‚   â””â”€ Usuario click en link â†’ Deep link a app      â”‚
    â”‚                                                    â”‚
    â”‚ EMAIL:                                             â”‚
    â”‚   â””â”€ Usuario click en CTA â†’ Deep link a app       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. COMPARACIÃ“N: ANTES vs DESPUÃ‰S

### ANTES (Estado Actual - Fragmentado):

```
Get Ready Module:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NotificationBell         â”‚
â”‚ â†“                        â”‚
â”‚ get_ready_notifications  â”‚
â”‚ â†“                        â”‚
â”‚ Solo Get Ready           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Global System (Inactivo):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NotificationBell         â”‚
â”‚ â†“                        â”‚
â”‚ notification_log (vacÃ­a) â”‚
â”‚ â†“                        â”‚
â”‚ No se usa                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Otros MÃ³dulos:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sin notificaciones       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resultado: ğŸ˜
- Usuario ve 2 bells diferentes
- Datos fragmentados
- Mantenimiento duplicado
- Canales no configurados
```

### DESPUÃ‰S (Objetivo - Unificado):

```
TODOS LOS MÃ“DULOS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          NotificationBell              â”‚
â”‚               (Ãºnico)                  â”‚
â”‚                 â†“                      â”‚
â”‚        notification_log                â”‚
â”‚                 â†“                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â€¢ Sales Orders                    â”‚ â”‚
â”‚  â”‚ â€¢ Service Orders                  â”‚ â”‚
â”‚  â”‚ â€¢ Get Ready                       â”‚ â”‚
â”‚  â”‚ â€¢ Recon Orders                    â”‚ â”‚
â”‚  â”‚ â€¢ Car Wash                        â”‚ â”‚
â”‚  â”‚ â€¢ Contacts                        â”‚ â”‚
â”‚  â”‚ â€¢ Chat                            â”‚ â”‚
â”‚  â”‚ â€¢ System                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â†“                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Channels:                         â”‚ â”‚
â”‚  â”‚ â€¢ In-App âœ…                       â”‚ â”‚
â”‚  â”‚ â€¢ Push âœ…                         â”‚ â”‚
â”‚  â”‚ â€¢ SMS âœ…                          â”‚ â”‚
â”‚  â”‚ â€¢ Email âœ…                        â”‚ â”‚
â”‚  â”‚ â€¢ Webhook âœ…                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Resultado: ğŸ‰
- Una sola fuente de verdad
- Experiencia unificada
- Multi-canal operativo
- Analytics completos
- FÃ¡cil de mantener
```

---

## 6. PUNTOS DE INTEGRACIÃ“N POR MÃ“DULO

### Sales Orders:
```typescript
// En cualquier acciÃ³n relevante:
import { notificationService } from '@/services/notificationService';

// Ejemplo: Nuevo pedido creado
await notificationService.send({
  dealerId,
  userId: assignedUserId,
  notificationType: 'order_created',
  entityType: 'sales_order',
  entityId: order.id,
  channels: ['in_app', 'push'],
  data: {
    order_number: order.order_number,
    customer_name: order.customer_name,
    status: order.status
  },
  priority: 'normal'
});

// Ejemplo: Estado cambiÃ³
await notificationService.send({
  dealerId,
  userId: order.assigned_user_id,
  notificationType: 'status_changed',
  entityType: 'sales_order',
  entityId: order.id,
  channels: ['in_app', 'push', 'sms'],
  data: {
    order_number: order.order_number,
    old_status: oldStatus,
    new_status: newStatus
  },
  priority: newStatus === 'completed' ? 'high' : 'normal'
});
```

### Service Orders:
```typescript
// Ejemplo: Due date approaching
await notificationService.send({
  dealerId,
  userId: order.assigned_user_id,
  notificationType: 'due_date_approaching',
  entityType: 'service_order',
  entityId: order.id,
  channels: ['in_app', 'push', 'sms'],
  data: {
    order_number: order.order_number,
    due_date: order.due_date,
    minutes_until_due: 30
  },
  priority: 'urgent'
});
```

### Recon Orders:
```typescript
// Ejemplo: Approval required
await notificationService.send({
  dealerId,
  userId: null, // broadcast a managers
  notificationType: 'approval_required',
  entityType: 'recon_order',
  entityId: order.id,
  channels: ['in_app', 'email', 'push'],
  data: {
    order_number: order.order_number,
    requested_by: requester.name,
    reason: 'High cost item'
  },
  priority: 'high'
});
```

### Chat:
```typescript
// Ejemplo: Nuevo mensaje
await notificationService.send({
  dealerId,
  userId: recipientId,
  notificationType: 'new_message',
  entityType: 'chat_message',
  entityId: message.id,
  channels: ['in_app', 'push'],
  data: {
    sender_name: sender.name,
    message_preview: message.content.substring(0, 100),
    conversation_id: message.conversation_id
  },
  priority: 'high'
});
```

---

## 7. RESUMEN VISUAL DE GAPS

```
COMPONENTES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Componente         â”‚ Existe   â”‚ Visible  â”‚ Funciona â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NotificationBell   â”‚    âœ…    â”‚    âœ…    â”‚    âœ…    â”‚
â”‚ SmartCenter        â”‚    âœ…    â”‚    âœ…    â”‚    ğŸŸ¡    â”‚
â”‚ PreferencesModal   â”‚    âœ…    â”‚    âŒ    â”‚    âœ…    â”‚
â”‚ AnalyticsDashboard â”‚    âœ…    â”‚    âŒ    â”‚    âœ…    â”‚
â”‚ TemplateManager    â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SERVICIOS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Servicio           â”‚ CÃ³digo   â”‚ Config   â”‚ En Uso   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NotificationSvc    â”‚    âœ…    â”‚    âœ…    â”‚    âŒ    â”‚
â”‚ PushNotifSvc       â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ SMSHandler         â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ EmailHandler       â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ WebhookHandler     â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BASE DE DATOS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tabla              â”‚ Creada   â”‚ Poblada  â”‚ En Uso   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ notification_log   â”‚    âœ…    â”‚    âŒ    â”‚    ğŸŸ¡    â”‚
â”‚ delivery_log       â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ preferences_univ   â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ dealer_rules       â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ templates          â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MÃ“DULOS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ³dulo             â”‚ Status IntegraciÃ³n           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Get Ready          â”‚ âœ… Funcional (tabla legacy)  â”‚
â”‚ Sales Orders       â”‚ âŒ Sin integrar              â”‚
â”‚ Service Orders     â”‚ âŒ Sin integrar              â”‚
â”‚ Recon Orders       â”‚ âŒ Sin integrar              â”‚
â”‚ Car Wash           â”‚ âŒ Sin integrar              â”‚
â”‚ Contacts           â”‚ âŒ Sin integrar              â”‚
â”‚ Chat               â”‚ âŒ Sin integrar              â”‚
â”‚ System             â”‚ âŒ Sin integrar              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CANALES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Canal              â”‚ CÃ³digo   â”‚ Config   â”‚ Operativoâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ In-App             â”‚    âœ…    â”‚    âœ…    â”‚    âœ…    â”‚
â”‚ Push (Web)         â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ SMS                â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ Email              â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ Webhook            â”‚    ğŸŸ¡    â”‚    âŒ    â”‚    âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Leyenda:
âœ… Completo/Funcional
ğŸŸ¡ Parcial/En Progreso
âŒ Faltante/No Funcional
```

---

**Este diagrama complementa el reporte principal y puede ser usado para presentaciones al equipo.**

**PrÃ³xima actualizaciÃ³n:** DespuÃ©s de completar Fase 1 del Roadmap
