<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/webp" href="/favicon.webp" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Anti-cache headers for critical updates (mobile browsers) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ðŸ”´ CRITICAL PERFORMANCE FIX: Preload translations BEFORE JS execution -->
    <!-- This reduces perceived load time by 500ms-1s by starting download earlier -->
    <script>
      (function() {
        try {
          // Detect user's preferred language (same logic as i18n.ts)
          const savedLang = localStorage.getItem('language');
          const browserLang = navigator.language ? navigator.language.split('-')[0] : 'en';
          const preferredLang = savedLang || browserLang || 'en';

          // Validate language (only EN/ES/PT-BR supported)
          const validLang = ['en', 'es', 'pt-BR'].includes(preferredLang) ? preferredLang : 'en';

          // Create preload link for translation file
          const preloadLink = document.createElement('link');
          preloadLink.rel = 'preload';
          preloadLink.as = 'fetch';
          preloadLink.href = '/translations/' + validLang + '.json?v=1.3.34';
          preloadLink.crossOrigin = 'anonymous';
          document.head.appendChild(preloadLink);

          console.log('âš¡ Preloading translations for:', validLang);

          // Also preload English as fallback if user prefers ES/PT-BR
          if (validLang !== 'en') {
            const fallbackLink = document.createElement('link');
            fallbackLink.rel = 'preload';
            fallbackLink.as = 'fetch';
            fallbackLink.href = '/translations/en.json?v=1.3.34';
            fallbackLink.crossOrigin = 'anonymous';
            document.head.appendChild(fallbackLink);
            console.log('âš¡ Preloading English fallback');
          }
        } catch (error) {
          // Fail silently - translations will load normally via i18n.ts
          console.warn('Translation preload failed (non-critical):', error);
        }
      })();
    </script>

    <title>My Detail Area (MDA) - Dealership Operations Hub</title>
    <meta name="description" content="Professional dealership operations management platform. Coordinate Sales, Service, Recon, and Car Wash departments with order tracking, notifications, and comprehensive reporting." />
    <meta name="keywords" content="dealership management, automotive operations, order tracking, vehicle detailing, dealership software" />
    <meta name="author" content="MDA Team" />

    <meta property="og:title" content="My Detail Area (MDA) - Dealership Operations Hub" />
    <meta property="og:description" content="Professional dealership operations management platform for Sales, Service, Recon, and Car Wash departments." />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
  </head>

  <body>
    <div id="root"></div>
    <!-- Portal dedicado para notificaciones toast (Sonner) -->
    <div id="toast-portal"></div>
    <script>
      // Polyfill for require in browser environment
      if (typeof require === 'undefined') {
        window.require = function(module) {
          // Suppress warnings for known third-party widget dependencies
          if (module === '@emotion/is-prop-valid') {
            return {}; // Silent return for MDAChat widget
          }
          console.warn(`require('${module}') called in browser - returning empty object`);
          return {};
        };
      }

      // Additional Node.js polyfills
      if (typeof process === 'undefined') {
        window.process = { env: {} };
      }

      if (typeof Buffer === 'undefined') {
        window.Buffer = {};
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>

    <!-- MDAChat Live Chat Widget -->
    <script>
      window.BeChatSettings = {
        widgetDomain: "https://dds.mydetailarea.com",
      };
    </script>
    <script src="https://support.mydetailarea.com/livechat-loader.js" async defer></script>
  </body>
</html>
